const Hotel = require('../models/hotelModel');
const AppError = require('../utils/appError');
const catchAsync = require('../utils/catchAsync');
const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY)

exports.getCheckoutSession = async(req, res, next) => {
    // 1. get the currently booked tour
    const hotel = await Hotel.findById(req.params.hotelID);

    // Create checkout session'
    const session = await stripe.checkout.sessions.create({
        payment_method_types:['card'],
        success_url: `${req.protocol}://${req.get('host')}/`,
        cancel_url: `${req.protocol}://${req.get('host')}/overview/`,
        customer_email: req.user.email,
        client_reference_id: req.params.hotelID,
        line_items: [
            {
                name: `${hotel.name} Hotel`,
                description: hotel.summary,
                // images: [`data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBwgHBgkIBwgKCgkLDRYPDQwMDRsUFRAWIB0iIiAdHx8kKDQsJCYxJx8fLT0tMTU3Ojo6Iys/RD84QzQ5OjcBCgoKDQwNGg8PGjclHyU3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3N//AABEIAHsArQMBIgACEQEDEQH/xAAbAAADAAMBAQAAAAAAAAAAAAAEBQYCAwcBAP/EAEMQAAIBAgQDBgMFBQYEBwAAAAECAwQRAAUSIQYxQRMUUWFxgSKRoRUjMrHBQlJi0fAHM3KCkvFTZLLhFiU1Q2Nzov/EABkBAAMBAQEAAAAAAAAAAAAAAAECAwAEBf/EACQRAAICAQQDAQADAQAAAAAAAAABAhEDEiExQQQTYVEUIjIF/9oADAMBAAIRAxEAPwDnvFVHD3taylUGOSMO9uu5F/pvh1wnmTVVMYZSTLDYavFenvzGPuKKcUebjSpMcsV3ToN+dvzwkaKbIK+lq4bmkqEDrbcEHmvqLXH++OXJDVHSzqhLs6CF1LthXWURiq5Ag+7mAnj99mHzH1wdRVKzwq6MCrAEEHnjfUtGtK0zkDsDqJtyRrBvrpPtjnwJpuLKZOLQLHESg6bY8ZSOYw3yGeEyJIvdqlRzj18/rj3NactOzrTmJCbhRuB74s8e1iLJvRe8NZrRRZRTRVEjKQpvqjOnck87W64aFctr1PYTQyH+BwccdWSana8U0kR/hJGCEzau27SUTAcu1UN9eeKLMuxPVfB0aLJ4pqpl02t4jBUvDkDrZQt8c+o+JaunYFQ6D/4pSAfY3GH1LxrOFu2ogfiMkQIHupGCpRYHGSNuZ8PCnu1rD0wsTKpH3RDhtVcSRZmqIGhFuemW30OHlDmGWrEEKuptzaO/1F8aotmuUURkmVyLuyHG3Lso7zU6amMtClmZSOZB2/28sWNbW5eqoIuzkMjabpY6BYm5HPyt4keeFgpp0knkpJnaOR1YLPGH0Wta2kgc7ne+59sLOMEthozk3uLs7yqlhy3tkEaTR9Li5BO4/I4kp6lowbKfli5iymqip6gK8IMzsZdcJbXf1bbl49cT0+QTUcbrAsL0xcMXllfWAWBaykG5sdt/LE0vhTV9JppZZjYC2GVBQyzEXT6YpqDgqaR9czdml+R54Z1dBR5RH8E95ByQC7ep8B64vGFbsjKd7I1ZPw4AoeZADa4wxrKrK8oXTMdcwG0Ue7e/gPXExnHGbrGYKZrdCITufVv0HzxGVdVNWSWmcrETcxobX9fE+uC8qWyF9be7KXPeOJGLw01o4/8AhwHc/wCJ/wBBbEhNneYu33cvYp0VMN6+noqjs+4UvdIUHxSVEm7HxxpgyiCZS0Xbz2Ni0a2GFak2HZIXcXRn7egT/ljce+PDlAnyKjpKoXgqYEaGXrHIRe38vceGHecU7ScUSSusLiOnj0i5uwLNdf8Avz5ehrcvyzLazIKWlnXSO7qp3vpsOXtg2pSoanGKdHH+HZ58vrJMor/hljY9mTyI5/luMWFE4dg81Pqj/C8clrOvUYB4v4cne+gk5hSDVDKo/v4/D/EP657buH6xczoUlsNdrSL4HEZqnZVboo6b/wAKkATZXUwsOsb7D649r8u4brbtS5vWUj/xAgYDkonmeOSPYMoDD+IbH6aT742VWUz06I0sZCvujdDhvbLtCeqP6KajIKtWvQZ/DMvQSLgb7M4hQ/3NDUjxVgD+mL3OOF8vpqWOVO3UuP3wQD8sTv2bKm8Uz7fTCydPdBgrWzAKGgzMkCrySrUX/FF8Yw7lkSgopKSSWWCKWxdZKc7n1GPctbO1nWGjrXDHkGbb64Mlz/iCmZoalYJ9JsdaAg/K2GU4AcZ2TBFG5+7radm8C1j9cZpFURG8DNv1je+GNXW0tYG+0OH6VyeZjXST8hgGOg4aaRWNBWUpPMxSkW+uEai3sylv8HvDMbVVY/fHZp0jtEZOYBI1Wv6DFrGnZxqui5Nrg+HhiKoUyGKNO65zXU7q1w0ylt8VlFmdPVxhI6uGomQfEY9tXnbpilJb2Rk3LoMuWFtrDa3+4wFnFdSZcqS1Loo1Aoh5s18bGqAkbOEL2/DGvNz4D5Yj82p8xqapquvy+qBFtKhNaqPAEHfBVsVLcOzTjXVHoo1NyP2dvr09vniPrKutzBmWViRe5RLgep8fU4e08NVnkjTU+U6Il+DU69kgt433OB82yvKmULX5oX0r8VLRbJfzfGmm+WPBpbJEvUTUtM2mSZS97CKH42J/IYMy/Lc2rVEkNNFl9N1nqfxW98aqjijIMjHZ5bDEsg6xDtHP+Y7fXCOTibOc+rBT5bSAuxOkzPq28d7KPrhFS4RRxk/hZxrw9lAaWplmzepBvsSIl8rnphfW/wBpfdpeypJKKkiA2iiTXb1IxPTcJ1kxVuIc7jjvv2KG5PoNh9DjZHknDEC6O6VVUers5T6Fl/LD63+ieuC5FGVLU8VUUj1s8a1FGVihkcbFSGNmJ8wN/bHUOBuH/suN2GZNUPfs5YgRoQjn8Kmwa/rsPPHN+E6d4MpzCzadUqcv8LYfTZXxFkea1GbcP1YqVlkMktITpJvuQBex/rY42qN2PKEq0WdVzHLIcwptOl0mU3jlAuUOOaZjA3D3EXeyhiglA75CB8KsTYOPLz87YqOFuP6TNn7rVBqHMU2eml+Ek+V8MM5p0zfNWp5owS1AbhrWI18j6/pg5IqSJw1QdMXEw1EDRxMBez38uv039seomqOEmqWQl7FN7rhVksclBWy5ZUB2MBJhYjd4+qnzF7H1B64pY6SXuParSO+iTUuiHdhfncb28scsF0WmUGeRAxopnf8AwWvhVTinQESAbeON44vgdhG+W12q/LsG/ljZUZ3lkXxVlC0faANdk8fXHTOMZb2Qg5R2owkqKSliMwjDaeduePmFFOmqRApP72NtFJlWZESUtFJLGCQxCAoTbkceVa5LBMBVGanZzsHVgD5D54mofR/Z8FrZalQ+imQuT0GGdHkFNSIJ8wdSV303+EfzxjUZ3SZcqQ0EJHabh2U7325czhJWVdS6mozSeCGJlFu+XQC/Mqv4ri3UdeeGSjH6wNyl8Qzr8wyyqmNPTUlI7WP3kyDSPpieFFP3hpaCHVMi6glINx5Dew9zgefN8tqVKZVltXm7Br3iUxwnyJvYj/E2NdfmHENVTFDUUOXwoLLS0t5GPS1l+Ee98K2nyNGLXAbUB55u9cQVsVFHGthFE/aSfT4V+uElRxjDSTNFk1fmdVbZUiOtvoSMLMrGUZnXPSyQ1+Z18X94KyTTEpvvpUbWxY0eS1yR9nF3egit+CkiCfUb/XG3Q1LsUzJxjn1IZ5UjoKW3wtXz2PrbkPliebhyklP/AJvmlbmUgP8AdU6aY7+p2t6YvJclgjIfMKqRwP2p5P1OPo5cnjDd1ZZyhswp0MxB/wAoNsMwaqIqsyump8orPs7JoIR2LappLu9reJtY+5xIzx1lGgnpahopeV06C4FvTHT+Is3j+yquJKKqs0LDW6BVHsTf6Y51U1VBUUhWnnqHqgR8HYaUG++536Y3A0WpJse8I5dNmWWrPVylmZ2DabLextyGKlMipEQAqPfCXgWkqqvKXTvksCwzMv3KJdifiuSwPiBt4Y+rsvrHrJl73XsqOVUiolG1/wCEgfTFceJ5JOKObLlWNWyR4VLSZLWAsbmoUD/Sf549rs/qYM7rQ+YVyqZpFjCBTaxsOh5WxjwkwGWVKk7dv+gxL54urPq9dt6pxvy/FgQp7FvIbTHOYZvHmsUYkzWeoqUuYi9OqlSOVnABxQcM8Vy06xZhxBNV1MVFLHFG0MzIwDajdgCNYGnkfE88RjZZmWXVUbZhRzwrcr2kiEqduh5YOpj2nDuYADnUREC/gr4E2uhsP94Ozp2c5zJmXFEfcHR42hV0IIBikGrUT4j4QrD9bYNgzXNFQo/DLzO1irxVsX0BH54kuFqeiqsyqJKqo0H73syAfgYSuVN+W+o+lvPBNRm9dS5wsVWlUrfeMsqztCsllJLMLHey/s2v74ilKWSo1ZsmSEI1IsKPOcy7XVNklSQNyFkp7n13GKeh7xV5XNLWRtCTuqSldUY87GxuOW+I7gysavo6+aplE0zTGw7csCulTcH92+/vbFA1QlbPURVXZ6oEUW1WF9yfLbHm5f8AqRw5JQlG2h/TqSaNVHxHWUk7AZXmTQn/ANsUY+YPaH8sCZlxGK2pDmlqGIOiOOdY4VVr8rsTc89gpJ9sJeIameKuZg80kCyxGOnEuzNZzbbmDptfcemFc01RHlWWUaU88ITMhMUVbtd/iHxKLbBuQN+uOvF5TnDUM8EbQ8zLOKuLNkpq6XubzQNIO6QBToUEm8zgEAW/dwgzupyyDLJa/KqiirMwhZCpknNU/wARtuG25X5AePTBmcsZ+I8riqkMzvTKSJSxO6m9w3XbGquymjpOJaKMUSCjkmAeJI9Nzov0t4t9cLj8lTatE6SbVcFLkNTR1uVU9TXNNUO0auQ33aA26Bio+WPMzzeEZVV/Z1HTskcepmSpQuBfewF9/Ugb49Wio5coih7BkVfhUNtsCRY79BhHxBU5MtJVxQTU8UvdtMSqd2Zb3Fh6YZ5Je3RQ0dLhqbEvByTPxFWzQVBhDqxtpVmX4htci3Xwxaz1VAGEeY5rXI1gzIJAob0IsPpiM4EIObzEG5MDE/6hisz9kTL41ljR6dxG0pERaQWla1iOXL649LBg9mSm+jz/AC/J9NOu6CM3jyNoNWX04lqFNyTe9rA/FyJ2I2vhVls2YxTyxUoqxLJql0RTqg0qFBJ1c+Y9sbeGqgyGrliqEC9rpDFbhgFA28RthVnebTZfxO4WdQrwPGGDMpVnRLHbpdcJhqWbRLgpnT9OqPI9zuaum4anlleVopKbUBNIDa6322528McyKx2IZ+zkc7ELffxOLDMaqqk4VczTM/dqaSLSqCwKgg3O5Bt12vjm61ksNQjIbnUNN/2TfB87x9Eo6Hyc/jZM0sM76Z0rgHNPs6OSlVJZkUmWQIi3YWUDdjYYY55PQx1TGbvXau7uY49TlFJ2uFJ09fliBoc9qIKSVI1ZJAwRzENgttrk+JAOHGTZUKmKWTNZoWqO0N0aTkb8+f8AQAxz+LPLjk2t2QySU8ahJkbk8zxUc1jZTJ+QwBm+X10dRPU1dHURQySsRLJEwVrnobYLov8A0tv/ALz/ANIxdx8aZa0SwT8Pa0C6HY1GovbyItikMqxTtq0e1mxPIv6k7WGTM+F6aqrox3sSSMk40rqW4B1ee4/rkz/syienzGt7RVdewvYm97EfL1xb8J5zQZtFP2OVJSxRELsRck+g8sA8U59l+VZtqRVdu5tCURvwMXB+KxuOWOfJlbk9KDij64tTOfZYtRV5+TRsyzzSVRVA3gbj8z8sP04dqq6qEtVNNTysj/AAxsvLex67i3hhPlDRPUSyQRqHEMl5SN97k/nz8BjqmUd2cTztAySXEalviOlRa3PbmQfO+GyOmmuSaUZuyZyLh+XLqqUUtUpj7EppKFSF1C+4wdDRZhNmmcdtMl1SXQ7Q7KTsdNjc9Om+K3KUj0TvIirMWIDab/Dt+uNqoYaqaRwpVlufut2Jv4Y8bK5OctjtWRpL4czqa6aheKGsNaYIVCDu9N8J5FmDHnvtY+PQG2PKjiSjdIHhilqQZEaQMjIiWB3FuoNremLDPc2ioUqGiymepYFQI2iCg+5HryvhJwrmz0dH3StyaRWDMyyQgOGDOTY7XFtXXwx344xcVKhZT3EeXzVed1hzKtJDQVSQIyKbOrEj8R32DeGGnHcb0lfC2VVgirIisxL2GjYi/wCHrq8+uLeFaeR1vS2Y2YMyAMuOSZ5LW5fRLFUCaGQPsknUb8r9MaCvJfQ0McJPcqe8z5pwxFAbzVFOEScagC7G2plA5g74kcxopoO/aqNNAUlWkJ1pdbXFvy5bnDLLOHuIc2pabM8uZY0kQiJmqFT4b23AXyw0PCebplEtHCs81ekCsx1DRIxc3Cu1rm1tjyt1vt23JbI5pYcUZXqJ7gCslizaptGh7OAg65CAdx5HwxS5vWz5lTSxu3ZwNGoj1LcJZtQP4dxz69cSFNltTT1IkFcDItwY2G1+RB5XwfW1lTSUTNNTxuzaUVokIAA5ddgMZZpRdxe50fwseTeSvsdcPtPkNGKZZEdef3kAvfruX6+FseVNHBm+eLmFTI0jRrcUsZ+EkAAE2Fx7eXneTn4gqXLAO7DVqJJG5wJNmNRUVMVWGIlp/iH3mnVvfCxnKxsniY9OxaVkEGX5TmkcMEjJVUzySFhICkljvcrZhbbe3LHPIwofU50qGBJvtz/746HBn8uc8HZhPOqpL3eVWCXtsp8fbHLamVnUqLm5w+uWSlLo5VijCE67KaimjdOz7wkUcswZm1C9rcz/AA36/ni9yueXuwENZQ08Y5BJFfX4sT1J898cyyoRvSCKossiOV0tsQOdyMUdHlNPLEGejgfb4SUVtvXCwzrBJ7HmQ8J5OXRNZeh+yLgbtUuP/wAr/PBbIVZw3NXscD5W+nK4x/zMhH+mPDiWknlqJQKac/eG5ELtbfnsL/LEs/J7WKSSKr+z5mTKsyeIAyCRdNztfSbYlanKc24gzOWqVKde1VZCzSgAKwLA7X8D9Bim4fpK2nyuqpKZJC9RIj9rLC0SooG+zbk+2Dcp4cqoI4Q88SMsSRvo5fCCBbbzxozUF9IZorI3+ElRUtRkVQVmigqpDD2umOTUhUOAQSQN7X2x1vKUSmhpY2uzIBrY9WO7H5k4gaagbMs/o52naSPt2SFOjQxWJfyu+w8sdGhpwVNj8XhgTetpixioKkHZfLTIrmZGZidrHBtXNT1MRLRHWBZTfAMNO0dtQsB44YwaUpmU9lf53w0eKFkt7FJmXkV3HljWq2QLfYHnguaFdZYPcW6eOPlQKN+XTzxFoomL8yyynzKNYquMkBbAqxUjzuMSGZ8CQC7JAtUh6fhcDw2/FjoBFsYlRe4uMDgrDLKPByVqauyyQpkeYvRSRjSIWTl5WP8ALC7iDN8/rqelhzHWZ4ZGDGllMXarYbtbbmPDHYcwyyizGPTVwrJ4NyZfQ4na3huWG7UXZ1CDkrgB1/Q/TDrJOP06VLBl/wBKmczWqVm0m4bqrHcYwzCUmj0o7AahsDbFBm2UNVho2klp5EOopp3X5i4xPy5VmNO+idllprFu1CnULA229bD3xo0+zpk9HWwp7PY41uliMER0edVJ+4oxv+4rOfpfDfLeG841KaqhgkANz2j6f1/TFK072c7yp7UY5KJaLhrM4KkNE8kUllZSOa2G/riPnglWIsUbSf2rbY61FkddUIRVS0yoea3Z/a1gPrgeo4IppNLRSBXBuBo0rf5nb2xseam7I5oY6qLE+X1EqcKm8IMi1NOg+EiwZR0PngiHvMVbWpC6iMSfCoA2FsOK+mzZMr7p3eOQLYrJYPb/AC2OFcuV1ckxlp62hpNQGtXksXI62t7e2Od3KTdCWklQg4ZyzvuXh5XCwQ1Ehk33a6x2A+Rx1uJQ8aFAoj0gj0tjl/Csb9zlpAdbtUXCAddI3PkMdIo2CwxxuSSqAG3kMVzbyJKS6GkVgOa4VcUZg1JlvZQtepqnFPDbmGba/sMHq6AX3GI+vzFZ8+rMwAJp8ohKx35NM2wPz29sTUQ2N+GIFbNqowAPDQxLQxW5G27n1vixQ6VIv52xLcFwGDI6cvs895nPIsW6/K2KmPshHvb3ONvYGZqw1As3M4NEkcajxt1HPC5ZkV9iNuWCGn1WIYk+YwUwNG0aHfc8/HH1v3D8J5C2MV1Hc6R4Yyd4+RsD44Jj1hfYEX64wKW63xrEoLXvuMZGQeJt44WwpHthyIvjE6CNsYvIMaxIb2scLYTXWUNJWACqgSQr+FrWZfQ8xgdMqooTqgpYUbo+gavnzwY92Iv0GMdQ074KYdTqrBXowTuF9xjDukfUC4wUbMNmIxrt4sTjWYwekVTdSR5HA0kNv2Lfrg+Wqdhp20+GBGmNrHYdcCzA5ZF2NvcYHkWJmuSh9RfBUmmQXtfzBwK0VzyX3wUzE5kmVUeUoy0qtqb8TObnDlJmX8JtgJeWCk6Ya2+RKB87zP7Oy2apZ7SW0x3/AHjy+XP2xHzU8kGU5dlSajPmEwnnbVyBNlvv539jgnjsmSryqnckwySHWnQ7r/M42ljL/aDGslmCRfDcDb4L/qcVS2NZaUylEVUYBF2A8hgsGVkufwjfAaE2t0wQ5ItYkYgMblkI8sFxVRQAOTY8jhdc6TjZGxMQB/rfGCNxUr/xFN+gONUsq6zY7EcvDACk6Tj4k39sECQUakjcH1xmtUxFxcAjlhdc3bfrj4k/XChCzOdWPUqrkLc2GAVY6zjEEhjY9MCjDRakA3e9uhxiagajpY2PjhYztbn1GM6h2LjfkMFGDjOp57HxxqdjzB2wICbXvj4u1uZwTG1punXGBmPUY0SbxF/2tXPGrUdt8BmCTL7Xx92nmcD8+ePGZhyOMkCz/9k=`],
                amount: hotel.price ,
                currency: 'INR',
                quantity: 1
            }
        ]
    })

    // Creare session as response
    res.status(200).json({
        status: 'success',
        session
    })
};
